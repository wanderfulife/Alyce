{"remainingRequest":"/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/babel-loader/lib/index.js!/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/vue-loader-v16/dist/index.js??ref--1-1!/Users/j/Desktop/SurveyAppFirebase/survey-app/src/components/SurveyComponent.vue?vue&type=script&setup=true&lang=js","dependencies":[{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/src/components/SurveyComponent.vue","mtime":1704545774463},{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/babel.config.js","mtime":1704272822118},{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/cache-loader/dist/cjs.js","mtime":1704272811051},{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/babel-loader/lib/index.js","mtime":1704272811459},{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/cache-loader/dist/cjs.js","mtime":1704272811051},{"path":"/Users/j/Desktop/SurveyAppFirebase/survey-app/node_modules/vue-loader-v16/dist/index.js","mtime":1704272811453}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IHJlZiwgY29tcHV0ZWQsIHdhdGNoIH0gZnJvbSAndnVlJzsKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgcG9zdGVzLCBwbGFxdWVzLCB0eXBlVmVoaWN1bGUsIG9jY3VwYXRpb24gfSBmcm9tICcuL3JlcG9uc2VzJzsKaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9maXJlYmFzZUNvbmZpZyc7CmltcG9ydCB7IGNvbGxlY3Rpb24sIGFkZERvYywgZ2V0RG9jcyB9IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSc7CmltcG9ydCAqIGFzIFhMU1ggZnJvbSAneGxzeCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU3VydmV5Q29tcG9uZW50JywKICBzZXR1cChfX3Byb3BzLCB7CiAgICBleHBvc2UKICB9KSB7CiAgICBleHBvc2UoKTsKICAgIGNvbnN0IGNvbW11bmVzID0gcmVmKFtdKTsKICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gcmVmKCcnKTsKICAgIGNvbnN0IGZpbHRlcmVkQ29tbXVuZXMgPSByZWYoW10pOwogICAgY29uc3QgZGVib3VuY2VkU2VhcmNoID0gXy5kZWJvdW5jZShxdWVyeSA9PiB7CiAgICAgIGlmIChxdWVyeS5sZW5ndGggPj0gMykgewogICAgICAgIGZpbHRlcmVkQ29tbXVuZXMudmFsdWUgPSBjb21tdW5lcy52YWx1ZS5maWx0ZXIoY29tbXVuZSA9PiBjb21tdW5lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkudG9Mb3dlckNhc2UoKSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGZpbHRlcmVkQ29tbXVuZXMudmFsdWUgPSBbXTsKICAgICAgfQogICAgfSwgMzAwKTsKICAgIGNvbnN0IG9uU2VhcmNoSW5wdXQgPSAoKSA9PiB7CiAgICAgIGRlYm91bmNlZFNlYXJjaChzZWFyY2hRdWVyeS52YWx1ZSk7CiAgICB9OwogICAgYXN5bmMgZnVuY3Rpb24gbG9hZENvbW11bmVzKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy4vQU5BT0QueGxzJyk7CiAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGFycmF5QnVmZmVyLCB7CiAgICAgICAgICB0eXBlOiAnYnVmZmVyJwogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGZpcnN0U2hlZXROYW1lID0gd29ya2Jvb2suU2hlZXROYW1lc1swXTsKICAgICAgICBjb25zdCB3b3Jrc2hlZXQgPSB3b3JrYm9vay5TaGVldHNbZmlyc3RTaGVldE5hbWVdOwoKICAgICAgICAvLyBEZWZpbmUgJ2pzb24nIGhlcmUgc28gaXQncyBhY2Nlc3NpYmxlIHRocm91Z2hvdXQgdGhlIGZ1bmN0aW9uCiAgICAgICAgY29uc3QganNvbiA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3b3Jrc2hlZXQsIHsKICAgICAgICAgIGhlYWRlcjogMQogICAgICAgIH0pOwoKICAgICAgICAvLyBGaWx0ZXIgb3V0IGVtcHR5IHJvd3MgYW5kIGNyZWF0ZSBhIFNldCBmcm9tIHRoZSBjb21tdW5lIG5hbWVzIHRvIHJlbW92ZSBkdXBsaWNhdGVzCiAgICAgICAgY29uc3QgdW5pcXVlQ29tbXVuZXMgPSBuZXcgU2V0KGpzb24ubWFwKHJvdyA9PiByb3dbMF0pLmZpbHRlcih2YWx1ZSA9PiB2YWx1ZSAhPSBudWxsKSk7CiAgICAgICAgY29tbXVuZXMudmFsdWUgPSBBcnJheS5mcm9tKHVuaXF1ZUNvbW11bmVzKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIC54bHMgZmlsZTonLCBlcnJvcik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN1cnZleUNvbGxlY3Rpb25SZWYgPSBjb2xsZWN0aW9uKGRiLCAiQ2FlbiIpOwogICAgY29uc3QgbnVtID0gcmVmKDEpOwogICAgY29uc3QgcmVwb25zZSA9IHJlZih7CiAgICAgIHBvc3RlOiAnJywKICAgICAgcGxhcXVlOiAnJywKICAgICAgdHlwZTogJycsCiAgICAgIG51bTogbnVtLnZhbHVlLAogICAgICBvY2N1cGF0aW9uOiAnJywKICAgICAgb3JpZ2luZTogJycKICAgIH0pOwogICAgY29uc3Qgc2hvd1NlY29uZFNldCA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzaG93U3VibWl0QnV0dG9uID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHNob3dSZXR1cm5CdXR0b24gPSByZWYoZmFsc2UpOwogICAgd2F0Y2goKCkgPT4gW3JlcG9uc2UudmFsdWUucG9zdGUsIHJlcG9uc2UudmFsdWUucGxhcXVlLCByZXBvbnNlLnZhbHVlLnR5cGUsIHJlcG9uc2UudmFsdWUub2NjdXBhdGlvbl0sIChbcG9zdGUsIHBsYXF1ZSwgdHlwZV0pID0+IHsKICAgICAgaWYgKHBvc3RlICE9PSAnJyAmJiBwbGFxdWUgIT09ICcnICYmIHR5cGUgIT09ICcnKSB7CiAgICAgICAgc2hvd1NlY29uZFNldC52YWx1ZSA9IHRydWU7CiAgICAgICAgc2hvd1N1Ym1pdEJ1dHRvbi52YWx1ZSA9IHRydWU7CiAgICAgICAgc2hvd1JldHVybkJ1dHRvbi52YWx1ZSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd1NlY29uZFNldC52YWx1ZSA9IGZhbHNlOwogICAgICAgIHNob3dTdWJtaXRCdXR0b24udmFsdWUgPSBmYWxzZTsKICAgICAgICBzaG93UmV0dXJuQnV0dG9uLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH0pOwogICAgY29uc3QgcmV0dXJuQnV0dG9uID0gKCkgPT4gewogICAgICByZXBvbnNlLnZhbHVlLm9jY3VwYXRpb24gPSAnJzsKICAgIH07CiAgICBjb25zdCBpc1N1Ym1pdERpc2FibGVkID0gY29tcHV0ZWQoKCkgPT4gewogICAgICByZXR1cm4gcmVwb25zZS52YWx1ZS5wb3N0ZSA9PT0gJycgfHwgcmVwb25zZS52YWx1ZS5wbGFxdWUgPT09ICcnIHx8IHJlcG9uc2UudmFsdWUudHlwZSA9PT0gJyc7CiAgICB9KTsKICAgIGNvbnN0IHN1Ym1pdFN1cnZleSA9IGFzeW5jICgpID0+IHsKICAgICAgYXdhaXQgYWRkRG9jKHN1cnZleUNvbGxlY3Rpb25SZWYsIHsKICAgICAgICBxMTogcmVwb25zZS52YWx1ZS5wb3N0ZSwKICAgICAgICBxMjogbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJykucmVwbGFjZSgvXC8vZywgJy0nKSwKICAgICAgICBxNDogcmVwb25zZS52YWx1ZS5udW0sCiAgICAgICAgcTU6IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCdmci1GUicpLnNsaWNlKDAsIDgpLAogICAgICAgIHE2OiByZXBvbnNlLnZhbHVlLnBsYXF1ZSwKICAgICAgICBxNzogcmVwb25zZS52YWx1ZS50eXBlLAogICAgICAgIHE4OiByZXBvbnNlLnZhbHVlLm9jY3VwYXRpb24sCiAgICAgICAgcTk6IHJlcG9uc2UudmFsdWUub3JpZ2luZQogICAgICB9KTsKICAgICAgcmVwb25zZS52YWx1ZS5udW0rKzsKICAgICAgcmVwb25zZS52YWx1ZS5wb3N0ZSA9ICcnOwogICAgICByZXBvbnNlLnZhbHVlLnBsYXF1ZSA9ICcnOwogICAgICByZXBvbnNlLnZhbHVlLnR5cGUgPSAnJzsKICAgICAgcmVwb25zZS52YWx1ZS5vY2N1cGF0aW9uID0gJyc7CiAgICAgIHJlcG9uc2UudmFsdWUub3JpZ2luZSA9ICcnOwogICAgfTsKICAgIGNvbnN0IGRvd25sb2FkRGF0YSA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBxdWVyeVNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhzdXJ2ZXlDb2xsZWN0aW9uUmVmKTsKICAgICAgICBsZXQgZGF0YSA9IFtdOwogICAgICAgIGxldCBtYXhXaWR0aHMgPSB7fTsgLy8gT2JqZWN0IHRvIGtlZXAgdHJhY2sgb2YgbWF4aW11bSB3aWR0aCBmb3IgZWFjaCBjb2x1bW4KICAgICAgICBjb25zdCBtaW5XaWR0aCA9IDIxOyAvLyBNaW5pbXVtIHdpZHRoIGluIEV4Y2VsIHVuaXRzLCBhcHByb3hpbWF0ZWx5IDMgY20KCiAgICAgICAgcXVlcnlTbmFwc2hvdC5mb3JFYWNoKGRvYyA9PiB7CiAgICAgICAgICBsZXQgZG9jRGF0YSA9IGRvYy5kYXRhKCk7CiAgICAgICAgICBsZXQgbWFwcGVkRGF0YSA9IHsKICAgICAgICAgICAgUG9zdGU6IGRvY0RhdGEucTEgfHwgJycsCiAgICAgICAgICAgIERhdGU6IGRvY0RhdGEucTIgfHwgJycsCiAgICAgICAgICAgIE51bWVyb19FbnF1ZXRlOiBkb2MuaWQsCiAgICAgICAgICAgIC8vIEZpcmViYXNlIGRvY3VtZW50IElECiAgICAgICAgICAgIE51bWVyb19xdWVzdGlvbm5haXJlOiBkb2NEYXRhLnE0IHx8ICcnLAogICAgICAgICAgICBoZXVyZTogZG9jRGF0YS5xNSB8fCAnJywKICAgICAgICAgICAgcTY6IGRvY0RhdGEucTYgfHwgJycsCiAgICAgICAgICAgIHE3OiBkb2NEYXRhLnE3IHx8ICcnLAogICAgICAgICAgICBxODogZG9jRGF0YS5xOCB8fCAnJywKICAgICAgICAgICAgcTk6IGRvY0RhdGEucTkgfHwgJycKICAgICAgICAgIH07CiAgICAgICAgICBkYXRhLnB1c2gobWFwcGVkRGF0YSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIFNvcnQgZGF0YSBieSAnTnVtZXJvX0VucXVldGUnIChGaXJlYmFzZSBkb2N1bWVudCBJRCkKICAgICAgICBkYXRhLnNvcnQoKGEsIGIpID0+IE51bWJlcihhLk51bWVyb19xdWVzdGlvbm5haXJlKSAtIE51bWJlcihiLk51bWVyb19xdWVzdGlvbm5haXJlKSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4aW11bSB3aWR0aCBmb3IgZWFjaCBjb2x1bW4sIGNvbnNpZGVyaW5nIHRoZSBtaW5pbXVtIHdpZHRoCiAgICAgICAgT2JqZWN0LmtleXMoZGF0YVswXSkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgbGV0IG1heExlbiA9IE1hdGgubWF4KC4uLmRhdGEubWFwKGl0ZW0gPT4gaXRlbVtrZXldLnRvU3RyaW5nKCkubGVuZ3RoKSwgbWluV2lkdGgpOwogICAgICAgICAgbWF4V2lkdGhzW2tleV0gPSBtYXhMZW47CiAgICAgICAgfSk7CgogICAgICAgIC8vIENvbnZlcnQgZGF0YSB0byBhIHdvcmtzaGVldAogICAgICAgIGNvbnN0IHdvcmtzaGVldCA9IFhMU1gudXRpbHMuanNvbl90b19zaGVldChkYXRhLCB7CiAgICAgICAgICBoZWFkZXI6IFsiUG9zdGUiLCAiRGF0ZSIsICJOdW1lcm9fRW5xdWV0ZSIsICJOdW1lcm9fcXVlc3Rpb25uYWlyZSIsICJoZXVyZSIsICJxNiIsICJxNyIsICJxOCIsICJxOSJdLAogICAgICAgICAgc2tpcEhlYWRlcjogZmFsc2UKICAgICAgICB9KTsKCiAgICAgICAgLy8gU2V0IHRoZSB3aWR0aHMgZm9yIGVhY2ggY29sdW1uLCBlbnN1cmluZyBhIG1pbmltdW0gd2lkdGgKICAgICAgICB3b3Jrc2hlZXRbIiFjb2xzIl0gPSBPYmplY3Qua2V5cyhtYXhXaWR0aHMpLm1hcChrZXkgPT4gKHsKICAgICAgICAgIHdjaDogbWF4V2lkdGhzW2tleV0KICAgICAgICB9KSk7CiAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CiAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3b3JrYm9vaywgd29ya3NoZWV0LCAiRGF0YSIpOwoKICAgICAgICAvLyBFeHBvcnQgdGhlIHdvcmtib29rIHRvIGEgLnhsc3ggZmlsZQogICAgICAgIFhMU1gud3JpdGVGaWxlKHdvcmtib29rLCAiT2RDYWVuLnhsc3giKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBkb3dubG9hZGluZyBkYXRhOiAiLCBlcnJvcik7CiAgICAgIH0KICAgIH07CiAgICBsb2FkQ29tbXVuZXMoKTsKICAgIGNvbnN0IF9fcmV0dXJuZWRfXyA9IHsKICAgICAgY29tbXVuZXMsCiAgICAgIHNlYXJjaFF1ZXJ5LAogICAgICBmaWx0ZXJlZENvbW11bmVzLAogICAgICBkZWJvdW5jZWRTZWFyY2gsCiAgICAgIG9uU2VhcmNoSW5wdXQsCiAgICAgIGxvYWRDb21tdW5lcywKICAgICAgc3VydmV5Q29sbGVjdGlvblJlZiwKICAgICAgbnVtLAogICAgICByZXBvbnNlLAogICAgICBzaG93U2Vjb25kU2V0LAogICAgICBzaG93U3VibWl0QnV0dG9uLAogICAgICBzaG93UmV0dXJuQnV0dG9uLAogICAgICByZXR1cm5CdXR0b24sCiAgICAgIGlzU3VibWl0RGlzYWJsZWQsCiAgICAgIHN1Ym1pdFN1cnZleSwKICAgICAgZG93bmxvYWREYXRhLAogICAgICByZWYsCiAgICAgIGNvbXB1dGVkLAogICAgICB3YXRjaCwKICAgICAgXywKICAgICAgcG9zdGVzLAogICAgICBwbGFxdWVzLAogICAgICB0eXBlVmVoaWN1bGUsCiAgICAgIG9jY3VwYXRpb24sCiAgICAgIGRiLAogICAgICBjb2xsZWN0aW9uLAogICAgICBhZGREb2MsCiAgICAgIGdldERvY3MsCiAgICAgIFhMU1gKICAgIH07CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX19yZXR1cm5lZF9fLCAnX19pc1NjcmlwdFNldHVwJywgewogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgcmV0dXJuIF9fcmV0dXJuZWRfXzsKICB9Cn07"},{"version":3,"names":["ref","computed","watch","_","postes","plaques","typeVehicule","occupation","db","collection","addDoc","getDocs","XLSX","communes","searchQuery","filteredCommunes","debouncedSearch","debounce","query","length","value","filter","commune","toLowerCase","includes","onSearchInput","loadCommunes","response","fetch","arrayBuffer","workbook","read","type","firstSheetName","SheetNames","worksheet","Sheets","json","utils","sheet_to_json","header","uniqueCommunes","Set","map","row","Array","from","error","console","surveyCollectionRef","num","reponse","poste","plaque","origine","showSecondSet","showSubmitButton","showReturnButton","returnButton","isSubmitDisabled","submitSurvey","q1","q2","Date","toLocaleDateString","replace","q4","q5","toLocaleTimeString","slice","q6","q7","q8","q9","downloadData","querySnapshot","data","maxWidths","minWidth","forEach","doc","docData","mappedData","Poste","Numero_Enquete","id","Numero_questionnaire","heure","push","sort","a","b","Number","Object","keys","key","maxLen","Math","max","item","toString","json_to_sheet","skipHeader","wch","book_new","book_append_sheet","writeFile"],"sources":["/Users/j/Desktop/SurveyAppFirebase/survey-app/src/components/SurveyComponent.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <h1>OD Caen</h1>\n    <form @submit.prevent=\"submitSurvey\">\n      <div v-if=\"!showSecondSet\">\n\n        <div class=\"form-group\">\n          <label for=\"poste\">Poste</label>\n          <select id=\"poste\" v-model=\"reponse.poste\" class=\"form-control\">\n            <option v-for=\"option in postes\" :key=\"option.id\" :value=\"option.output\">{{ option.text }}</option>\n          </select>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"plaque\">Code Pays (immatriculation du véhicule plaque à l'avant):</label>\n          <select id=\"plaque\" v-model=\"reponse.plaque\" class=\"form-control\">\n            <option v-for=\"option in plaques\" :key=\"option.id\" :value=\"option.output\">{{ option.text }}</option>\n          </select>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"type\">Type de véhicule:</label>\n          <select id=\"type\" v-model=\"reponse.type\" class=\"form-control\">\n            <option v-for=\"option in typeVehicule\" :key=\"option.id\" :value=\"option.output\">{{ option.text }}</option>\n          </select>\n        </div>\n\n    \n    </div>\n\n\n      <div v-else>\n        <div v-if=\"reponse.type <= 4\">\n               <div class=\"form-group\">\n          <label for=\"commune-search\">Origine:</label>\n          <input id=\"commune-search\" v-model=\"searchQuery\" @input=\"onSearchInput\" class=\"form-control\"\n            placeholder=\"Start typing...\">\n          <select v-if=\"filteredCommunes.length > 0\" id=\"commune\" v-model=\"reponse.origine\" class=\"form-control\">\n            <option v-for=\"commune in filteredCommunes\" :key=\"commune\" :value=\"commune\">\n              {{ commune }}\n            </option>\n          </select>\n        </div>\n            <div class=\"form-group\">\n          <label for=\"type\">Nombre d'occupants:</label>\n          <select id=\"type\" v-model=\"reponse.occupation\" class=\"form-control\">\n            <option v-for=\"option in occupation\" :key=\"option.id\" :value=\"option.output\">{{ option.text }}</option>\n          </select>\n        </div>\n        </div>\n        <div v-else-if=\"reponse.occupation > 4\">\n          PL\n        </div>\n      </div>\n      <button v-show=\"showReturnButton\" type=\"button\" @click=\"returnButton\" class=\"btn-return\">Return to First\n        Set</button>\n      <input v-show=\"showSubmitButton\" type=\"submit\" value=\"Submit\" class=\"btn-submit\" :disabled=\"isSubmitDisabled\">\n\n    </form>\n  </div>\n  <button @click=\"downloadData\" class=\"btn-data\">Download Data</button>\n</template>\n\n\n<script setup>\nimport { ref, computed, watch } from 'vue'\nimport _ from 'lodash';\nimport { postes, plaques, typeVehicule, occupation } from './reponses'\nimport { db } from '../firebaseConfig';\nimport { collection, addDoc, getDocs } from 'firebase/firestore';\nimport * as XLSX from 'xlsx';\nconst communes = ref([]);\nconst searchQuery = ref('');\nconst filteredCommunes = ref([]);\n\nconst debouncedSearch = _.debounce(query => {\n  if (query.length >= 3) {\n    filteredCommunes.value = communes.value.filter(commune =>\n      commune.toLowerCase().includes(query.toLowerCase())\n    );\n  } else {\n    filteredCommunes.value = [];\n  }\n}, 300);\n\n\nconst onSearchInput = () => {\n  debouncedSearch(searchQuery.value);\n};\n\n\n\nasync function loadCommunes() {\n  try {\n    const response = await fetch('./ANAOD.xls');\n    const arrayBuffer = await response.arrayBuffer();\n    const workbook = XLSX.read(arrayBuffer, { type: 'buffer' });\n    const firstSheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[firstSheetName];\n\n    // Define 'json' here so it's accessible throughout the function\n    const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\n\n    // Filter out empty rows and create a Set from the commune names to remove duplicates\n    const uniqueCommunes = new Set(\n      json.map(row => row[0]).filter(value => value != null)\n    );\n\n    communes.value = Array.from(uniqueCommunes);\n  } catch (error) {\n    console.error('Error loading .xls file:', error);\n  }\n}\n\n\nconst surveyCollectionRef = collection(db, \"Caen\");\nconst num = ref(1);\nconst reponse = ref({\n  poste: '',\n  plaque: '',\n  type: '',\n  num: num.value,\n  occupation: '',\n  origine: ''\n});\n\nconst showSecondSet = ref(false)\nconst showSubmitButton = ref(false)\nconst showReturnButton = ref(false)\n\nwatch(\n  () => [reponse.value.poste, reponse.value.plaque, reponse.value.type, reponse.value.occupation],\n  ([poste, plaque, type]) => {\n    if (poste !== '' && plaque !== '' && type !== '') {\n      showSecondSet.value = true;\n      showSubmitButton.value = true;\n      showReturnButton.value = true;\n    } else {\n      showSecondSet.value = false;\n      showSubmitButton.value = false;\n      showReturnButton.value = false;\n    }\n  }\n);\n\nconst returnButton = () => {\n  reponse.value.occupation = '';\n}\n\nconst isSubmitDisabled = computed(() => {\n  return reponse.value.poste === '' || reponse.value.plaque === '' || reponse.value.type === '';\n});\n\nconst submitSurvey = async () => {\n  await addDoc(surveyCollectionRef, {\n    q1: reponse.value.poste,\n    q2: new Date().toLocaleDateString('fr-FR').replace(/\\//g, '-'),\n    q4: reponse.value.num,\n    q5: new Date().toLocaleTimeString('fr-FR').slice(0, 8),\n    q6: reponse.value.plaque,\n    q7: reponse.value.type,\n    q8: reponse.value.occupation,\n    q9: reponse.value.origine\n  });\n  reponse.value.num++;\n  reponse.value.poste = '';\n  reponse.value.plaque = '';\n  reponse.value.type = '';\n  reponse.value.occupation = '';\n  reponse.value.origine = ''\n};\n\nconst downloadData = async () => {\n  try {\n    const querySnapshot = await getDocs(surveyCollectionRef);\n    let data = [];\n    let maxWidths = {};  // Object to keep track of maximum width for each column\n    const minWidth = 21;  // Minimum width in Excel units, approximately 3 cm\n\n    querySnapshot.forEach((doc) => {\n      let docData = doc.data();\n      let mappedData = {\n        Poste: docData.q1 || '',\n        Date: docData.q2 || '',\n        Numero_Enquete: doc.id,  // Firebase document ID\n        Numero_questionnaire: docData.q4 || '',\n        heure: docData.q5 || '',\n        q6: docData.q6 || '',\n        q7: docData.q7 || '',\n        q8: docData.q8 || '',\n        q9: docData.q9 || '',\n\n      };\n      data.push(mappedData);\n    });\n\n    // Sort data by 'Numero_Enquete' (Firebase document ID)\n    data.sort((a, b) => Number(a.Numero_questionnaire) - Number(b.Numero_questionnaire));\n\n    // Calculate the maximum width for each column, considering the minimum width\n    Object.keys(data[0]).forEach(key => {\n      let maxLen = Math.max(...data.map(item => item[key].toString().length), minWidth);\n      maxWidths[key] = maxLen;\n    });\n\n    // Convert data to a worksheet\n    const worksheet = XLSX.utils.json_to_sheet(data, {\n      header: [\"Poste\", \"Date\", \"Numero_Enquete\", \"Numero_questionnaire\", \"heure\", \"q6\", \"q7\", \"q8\",\"q9\"],\n      skipHeader: false\n    });\n\n    // Set the widths for each column, ensuring a minimum width\n    worksheet[\"!cols\"] = Object.keys(maxWidths).map(key => ({ wch: maxWidths[key] }));\n\n    const workbook = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(workbook, worksheet, \"Data\");\n\n    // Export the workbook to a .xlsx file\n    XLSX.writeFile(workbook, \"OdCaen.xlsx\");\n  } catch (error) {\n    console.error(\"Error downloading data: \", error);\n  }\n};\n loadCommunes()\n</script>\n\n<style>\nbody {\n  background-color: #1e1e1e;\n}\n\n.container {\n  background-color: #1e1e1e;\n  color: white;\n  padding: 20px;\n  border-radius: 10px;\n  width: 300px;\n  margin: auto;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 5px;\n}\n\n.form-control {\n  width: 100%;\n  padding: 10px;\n  border-radius: 5px;\n  border: 1px solid #333;\n  background-color: #333;\n  color: white;\n}\n\n.btn-submit {\n  background-color: #4CAF50;\n  color: white;\n  padding: 10px 20px;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n  width: 100%;\n}\n\n.btn-submit:hover {\n  background-color: #45a049;\n}\n\n.btn-data {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  background-color: #4CAF50;\n  color: white;\n  padding: 10px 20px;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n  width: 100%;\n}\n\n.btn-data:hover {\n  background-color: #45a049;\n}\n\nh1 {\n  text-align: center;\n  color: #4CAF50;\n}\n</style>"],"mappings":"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"}]}